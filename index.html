<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #5a5a5a; -webkit-text-stroke: #5a5a5a; background-color: #e7edf5}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #5a5a5a; -webkit-text-stroke: #5a5a5a; background-color: #e7edf5; min-height: 16.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="ko"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;Gemini RAG 기반 사내 매뉴얼 챗봇&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&amp;display=swap" rel="stylesheet"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Noto Sans KR', sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.chat-bubble {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>max-width: 80%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>word-wrap: break-word;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.chat-bubble.user {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #3B82F6; /* blue-500 */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.chat-bubble.bot {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #E5E7EB; /* gray-200 */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #1F2937; /* gray-800 */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* 스크롤바 스타일링 */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>::-webkit-scrollbar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>::-webkit-scrollbar-track {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: #f1f1f1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>::-webkit-scrollbar-thumb {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: #888;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 4px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>::-webkit-scrollbar-thumb:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: #555;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="container mx-auto p-4 max-w-4xl"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;header class="text-center mb-6"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h1 class="text-3xl font-bold text-gray-800 dark:text-white"&gt;RAG 기반 사내 매뉴얼 챗봇&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="text-md text-gray-600 dark:text-gray-400 mt-2"&gt;Gemini API를 사용하여 매뉴얼 내용을 기반으로 답변합니다.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/header&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;main class="grid grid-cols-1 md:grid-cols-2 gap-6"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Left Panel: Knowledge Base Input --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-xl font-semibold mb-3 border-b pb-2 border-gray-200 dark:border-gray-700"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-2xl mr-2"&gt;📚&lt;/span&gt;1. 매뉴얼 학습시키기</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm text-gray-500 dark:text-gray-400 mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>여기에 학습시킬 매뉴얼 전체 텍스트를 붙여넣으세요. 내용이 길어도 괜찮습니다. (PDF, DOCX 등의 내용을 복사-붙여넣기)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;textarea id="manual-text"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>class="w-full h-96 p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>placeholder="예시)<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1">제 1조 (목적) 이 규정은 회사의 휴가 운영에 관한 사항을 정함을 목적으로 한다.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">제 2조 (연차 유급휴가)</span></p>
<p class="p1"><span class="s1">1. 회사는 1년간 80% 이상 출근한 직원에게 15일의 유급휴가를 준다.</span></p>
<p class="p1"><span class="s1">2. 3년 이상 계속하여 근로한 직원에게는 최초 1년을 초과하는 계속 근로 연수 매 2년에 대하여 1일을 가산한 유급휴가를 준다.</span></p>
<p class="p1"><span class="s1">..."&gt;&lt;/textarea&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="update-manual-btn" class="mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-transform transform hover:scale-105"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>매뉴얼 업데이트 및 학습</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>&lt;div id="manual-status" class="mt-2 text-sm text-green-600 dark:text-green-400"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Right Panel: Chatbot Interface --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md flex flex-col h-[34rem]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-xl font-semibold mb-3 border-b pb-2 border-gray-200 dark:border-gray-700"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-2xl mr-2"&gt;💬&lt;/span&gt;2. 챗봇에게 질문하기</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="chat-window" class="flex-grow overflow-y-auto mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Chat messages will be appended here --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div class="flex justify-start mb-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="chat-bubble bot rounded-lg p-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>안녕하세요! 좌측에 매뉴얼을 입력하고 학습시킨 후, 저에게 질문해주세요.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex mt-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="text" id="user-input"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="flex-grow p-3 border border-gray-300 dark:border-gray-600 rounded-l-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>placeholder="질문을 입력하세요..." disabled&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="send-btn"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="bg-blue-600 text-white font-bold py-2 px-6 rounded-r-md hover:bg-blue-700 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:dark:bg-gray-600 disabled:transform-none"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>disabled&gt;전송&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/main&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- DOM 요소 가져오기 ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const manualTextArea = document.getElementById('manual-text');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const updateManualBtn = document.getElementById('update-manual-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const manualStatus = document.getElementById('manual-status');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatWindow = document.getElementById('chat-window');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const userInput = document.getElementById('user-input');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const sendBtn = document.getElementById('send-btn');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- 전역 변수 설정 ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let knowledgeBase = []; // 매뉴얼 텍스트를 문단(청크) 단위로 저장할 배열</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`; // API 키는 Canvas 환경에서 자동으로 제공됩니다.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- 이벤트 리스너 설정 ---</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// "매뉴얼 업데이트" 버튼 클릭 이벤트</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateManualBtn.addEventListener('click', processAndStoreManual);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// "전송" 버튼 클릭 이벤트</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>sendBtn.addEventListener('click', handleUserQuery);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// 사용자 입력창에서 Enter 키 입력 이벤트</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>userInput.addEventListener('keydown', (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (event.key === 'Enter') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>handleUserQuery();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- 핵심 기능 함수 ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/**</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* 1. 매뉴얼 처리 및 저장 (RAG의 Ingestion/Indexing 단계)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* 사용자가 입력한 텍스트를 문단 단위로 분할하여 knowledgeBase 배열에 저장합니다.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function processAndStoreManual() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const manualText = manualTextArea.value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!manualText) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>updateStatus('학습할 내용이 없습니다. 매뉴얼 텍스트를 입력해주세요.', 'error');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// 간단한 문단 분할(Chunking): 빈 줄을 기준으로 텍스트를 나눕니다.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>knowledgeBase = manualText.split(/\n\s*\n/).filter(p =&gt; p.trim().length &gt; 0);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (knowledgeBase.length &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>updateStatus(`성공! 총 ${knowledgeBase.length}개의 문단(지식)으로 분할하여 학습했습니다.`, 'success');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>userInput.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>sendBtn.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>userInput.focus();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addMessageToChat('안녕하세요! 이제 저에게 질문할 수 있습니다. 무엇이 궁금하신가요?', 'bot');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>updateStatus('유효한 문단을 찾을 수 없습니다. 내용을 다시 확인해주세요.', 'error');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/**</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* 2. 사용자 질문 처리</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>async function handleUserQuery() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const query = userInput.value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!query) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addMessageToChat(query, 'user');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>userInput.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setChatLoading(true);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// 3. 관련 정보 검색 (RAG의 Retrieval 단계)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const relevantContext = findRelevantContext(query, 3);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// 4. LLM을 통한 답변 생성 (RAG의 Generation 단계)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const answer = await generateAnswerWithGemini(query, relevantContext);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addMessageToChat(answer, 'bot');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>console.error('Gemini API 호출 중 오류:', error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addMessageToChat('죄송합니다, 답변을 생성하는 중에 오류가 발생했습니다. 잠시 후 다시 시도해주세요.', 'bot');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} finally {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>setChatLoading(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/**</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* 3. 관련 정보 검색 (간단한 키워드 기반 검색)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* @param {string} query 사용자 질문</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* @param {number} topN 가장 관련성 높은 N개의 문단을 반환</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* @returns {string} 검색된 문단들을 합친 텍스트</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function findRelevantContext(query, topN) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (knowledgeBase.length === 0) return "";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const queryWords = new Set(query.toLowerCase().split(/\s+/));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const scoredParagraphs = knowledgeBase.map(paragraph =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const paragraphWords = new Set(paragraph.toLowerCase().split(/\s+/));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const commonWords = [...queryWords].filter(word =&gt; paragraphWords.has(word));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return { paragraph, score: commonWords.length };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// 점수가 높은 순으로 정렬</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>scoredParagraphs.sort((a, b) =&gt; b.score - a.score);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// 상위 N개의 문단을 선택하고, 점수가 0인 경우는 제외</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const topParagraphs = scoredParagraphs.slice(0, topN)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>.filter(item =&gt; item.score &gt; 0)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>.map(item =&gt; item.paragraph);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.log("검색된 관련 문단:", topParagraphs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return topParagraphs.join('\n\n---\n\n'); // 문단들을 구분자와 함께 합침</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/**</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* 4. Gemini API를 호출하여 답변 생성</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* @param {string} query 사용자 질문</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* @param {string} context 검색된 관련 매뉴얼 내용</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* @returns {string} 생성된 답변</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>async function generateAnswerWithGemini(query, context) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Gemini에게 전달할 프롬프트를 구성합니다.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// 이 프롬프트 엔지니어링이 RAG의 핵심입니다.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const prompt = `</span></p>
<p class="p1"><span class="s1">당신은 사내 매뉴얼 전문가 챗봇입니다. 아래에 제공되는 "매뉴얼 내용"을 바탕으로 사용자의 "질문"에 대해 답변해야 합니다.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">규칙:</span></p>
<p class="p1"><span class="s1">- 반드시 "매뉴얼 내용"에 근거해서만 답변하세요. 당신의 사전 지식을 사용하지 마세요.</span></p>
<p class="p1"><span class="s1">- "매뉴얼 내용"에서 답변을 찾을 수 없다면, "죄송하지만 문의하신 내용은 제가 학습한 매뉴얼에서 찾을 수 없습니다."라고 정확히 답변하세요.</span></p>
<p class="p1"><span class="s1">- 답변은 명확하고 간결하게, 한국어로 작성해주세요.</span></p>
<p class="p1"><span class="s1">- 어떤 매뉴얼 내용을 참고했는지 출처를 언급하지는 마세요. 그냥 답변만 생성하세요.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">---</span></p>
<p class="p1"><span class="s1">[매뉴얼 내용]</span></p>
<p class="p1"><span class="s1">${context || "참고할 매뉴얼 내용이 없습니다."}</span></p>
<p class="p1"><span class="s1">---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">[질문]</span></p>
<p class="p1"><span class="s1">${query}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">[답변]</span></p>
<p class="p1"><span class="s1">`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.log("Gemini API에 전달될 프롬프트:", prompt);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const payload = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>contents: [{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>parts: [{ text: prompt }]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// API 호출 시 지수 백오프를 사용한 재시도 로직</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let response;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let attempts = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const maxAttempts = 3;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const initialDelay = 1000; // 1초</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>while (attempts &lt; maxAttempts) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>response = await fetch(GEMINI_API_URL, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>headers: { 'Content-Type': 'application/json' },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>body: JSON.stringify(payload)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (response.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const result = await response.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>return result.candidates[0].content.parts[0].text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>} else if (response.status === 429) { // Too Many Requests</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>console.warn(`API 요청 제한, ${initialDelay * Math.pow(2, attempts)}ms 후 재시도...`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>await new Promise(resolve =&gt; setTimeout(resolve, initialDelay * Math.pow(2, attempts)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>attempts++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>throw new Error(`API Error: ${response.status} ${response.statusText}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(`API 호출 시도 ${attempts + 1} 실패:`, error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>attempts++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (attempts &gt;= maxAttempts) throw error;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>await new Promise(resolve =&gt; setTimeout(resolve, initialDelay * Math.pow(2, attempts)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>throw new Error("최대 재시도 횟수를 초과했습니다.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- UI 헬퍼 함수 ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function addMessageToChat(text, sender) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const bubble = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>bubble.className = `chat-bubble ${sender} rounded-lg p-3 mb-2`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>bubble.textContent = text;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const messageWrapper = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageWrapper.className = `flex mb-2 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageWrapper.appendChild(bubble);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>chatWindow.appendChild(messageWrapper);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>chatWindow.scrollTop = chatWindow.scrollHeight; // 항상 최신 메시지가 보이도록 스크롤</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function setChatLoading(isLoading) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (isLoading) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>sendBtn.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>userInput.disabled = true;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const loadingBubble = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loadingBubble.id = 'loading-bubble';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loadingBubble.className = 'flex justify-start mb-2';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loadingBubble.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="chat-bubble bot rounded-lg p-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="mr-2"&gt;답변을 생성 중입니다...&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900 dark:border-gray-100"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>chatWindow.appendChild(loadingBubble);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>chatWindow.scrollTop = chatWindow.scrollHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const loadingBubble = document.getElementById('loading-bubble');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (loadingBubble) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>loadingBubble.remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>sendBtn.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>userInput.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>userInput.focus();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function updateStatus(message, type) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>manualStatus.textContent = message;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (type === 'success') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>manualStatus.className = 'mt-2 text-sm text-green-600 dark:text-green-400';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>manualStatus.className = 'mt-2 text-sm text-red-600 dark:text-red-400';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
